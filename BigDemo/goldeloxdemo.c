/****************************************************************************************
*                                                                                       *
*  Goldelox 4D Serial Sample                                                            *
*                                                                                       *
*  Date:        13 October 2014                                                         *
*                                                                                       *
*  Description: Demonstrates Pretty much every Goldelox 4D Serial command.              *
*               This has been written as a console application.                         *
*                                                                                       *
*               The following file needs to be openned with Graphics Composer(GC) and   *
*               'saved' to offset 0 of a uSD card.                                      *
*               PoGa Intro\GCI_Demo1\Images\GCI_DEMO1                                   *
*  Compile: gcc -o goldeloxdemo goldeloxdemo.c -lgoldeloxSerial                         *
*  Run: ./goldelox                                                                      *
*                                                                                       *
*                                                                                       *
****************************************************************************************/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <errno.h>
#include <fenv.h>
#include <ctype.h>
#include <termios.h>
#include <sys/stat.h>
#include <goldeloxSerial.h>
#include <Goldelox_Types4D.h>
#include <Goldelox_const4D.h>

/*
 * 
 */

unsigned char Image[2054] = {0,  32,   0,  32,  16,   0, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x8C, 0x51, 0x84, 0x31, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0x84, 0x51, 0x10, 0xA2, 0x10, 0xA2, 0x84, 0x51, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x84, 0x51, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x84, 0x51,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x84, 0x51,
    0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x84, 0x51, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x84, 0x51, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2,
    0x84, 0x31, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x84, 0x51, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2,
    0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x84, 0x31, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0x84, 0x51, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2,
    0x10, 0xA2, 0x84, 0x31, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x84, 0x51, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2,
    0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x84, 0x51, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x84, 0x51, 0x10, 0xA2,
    0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x21, 0x04, 0x29, 0x45, 0x31, 0xA6, 0x94, 0xB2, 0x94, 0x92, 0x94, 0x92, 0x84, 0x31, 0x5A, 0xEC,
    0x18, 0xE4, 0x10, 0xA2, 0x84, 0x51, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x84, 0x51, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x21, 0x24, 0xB5, 0x96, 0x29, 0x65,
    0x42, 0x29, 0xCE, 0x7A, 0xC6, 0x18, 0xC6, 0x18, 0xC6, 0x18, 0xC6, 0x39, 0xBD, 0xF8, 0x52, 0xCB, 0x10, 0xA2, 0x84, 0x31, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x84, 0x51, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2,
    0x10, 0xA2, 0x10, 0xA2, 0x21, 0x24, 0xC6, 0x18, 0xAD, 0x55, 0x21, 0x24, 0x42, 0x29, 0xC6, 0x38, 0xB5, 0x96, 0xB5, 0x96, 0xB5, 0xB7, 0xBD, 0xF8, 0xBD, 0xF8,
    0xBD, 0xF8, 0x5A, 0xCB, 0x10, 0xA2, 0x84, 0x31, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0x8C, 0x51, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x21, 0x24, 0xC6, 0x18, 0xC6, 0x39, 0xA5, 0x14, 0x21, 0x24, 0x21, 0x45,
    0x42, 0x29, 0x39, 0xE7, 0x39, 0xE7, 0x52, 0x8A, 0x9C, 0xF4, 0xBD, 0xF8, 0xBD, 0xF8, 0xAD, 0x76, 0x29, 0x45, 0x10, 0xA2, 0x84, 0x31, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x84, 0x51, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x21, 0x24,
    0xC6, 0x18, 0xC6, 0x39, 0xBD, 0xF8, 0x94, 0xB2, 0x21, 0x04, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA3, 0x10, 0xA2, 0x10, 0xA2, 0x21, 0x04, 0xA5, 0x55, 0xBD, 0xF8,
    0xBD, 0xD7, 0x5B, 0x0C, 0x10, 0xA2, 0x10, 0xA2, 0x84, 0x51, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x84, 0x51, 0x10, 0xA2, 0x10, 0xA2,
    0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x21, 0x24, 0xC6, 0x18, 0xC6, 0x39, 0xBD, 0xF8, 0xA5, 0x35, 0x42, 0x08, 0x10, 0xA3, 0x29, 0x65, 0xD5, 0x34,
    0xE4, 0x0F, 0xE3, 0xEF, 0xBA, 0x89, 0x20, 0xA3, 0x52, 0x8A, 0xC6, 0x39, 0xBD, 0xF8, 0x7B, 0xF0, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x84, 0x31, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0x84, 0x51, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x21, 0x25, 0xC6, 0x18, 0xC6, 0x39, 0xBD, 0xF8,
    0xA5, 0x35, 0x42, 0x08, 0x10, 0xA3, 0x29, 0x65, 0xD4, 0xF3, 0xDA, 0x28, 0xD9, 0xA6, 0xD9, 0xA6, 0xC1, 0x85, 0x38, 0xC3, 0x29, 0x86, 0xD6, 0x9A, 0xBD, 0xF8,
    0x7B, 0xF0, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x84, 0x31, 0xFF, 0xFF, 0x84, 0x51, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2,
    0x10, 0xA2, 0x21, 0x25, 0xC6, 0x18, 0xC6, 0x39, 0xBD, 0xF8, 0xA5, 0x35, 0x42, 0x08, 0x10, 0xA3, 0x29, 0x04, 0xBB, 0x8E, 0xA9, 0xC6, 0xA1, 0x65, 0xA1, 0x65,
    0xA1, 0x65, 0x69, 0x04, 0x18, 0xA2, 0x52, 0x8A, 0xCE, 0x7A, 0xBD, 0xF8, 0x6B, 0x6E, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x84, 0x31,
    0x8C, 0x51, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x21, 0x25, 0xC6, 0x18, 0xC6, 0x39, 0xBD, 0xF8, 0xAD, 0x55, 0x42, 0x08, 0x10, 0xA3,
    0x10, 0xA2, 0x18, 0xA3, 0x20, 0xA2, 0x18, 0xA2, 0x18, 0xA2, 0x18, 0xA2, 0x18, 0xA2, 0x10, 0xA2, 0x18, 0xE4, 0xBD, 0xF7, 0xC6, 0x18, 0xB5, 0xB7, 0x42, 0x08,
    0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x8C, 0x51, 0xFF, 0xFF, 0x8C, 0x51, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0xC6, 0x38,
    0xC6, 0x39, 0xBD, 0xF8, 0xBD, 0xF8, 0x9C, 0xD3, 0x63, 0x0C, 0x63, 0x2D, 0x63, 0x2D, 0x63, 0x0C, 0x21, 0x04, 0x29, 0x45, 0x6B, 0x4D, 0x63, 0x4D, 0x63, 0x2D,
    0x7B, 0xCF, 0xC6, 0x39, 0xC6, 0x39, 0xBD, 0xF8, 0x84, 0x31, 0x18, 0xE4, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA2, 0x8C, 0x51, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0x8C, 0x51, 0x10, 0xA2, 0x10, 0xA2, 0x10, 0xA3, 0xD6, 0xBB, 0xBD, 0xF8, 0xBD, 0xF8, 0xBD, 0xF8, 0xBD, 0xF8, 0xC6, 0x39, 0xC6, 0x39, 0xC6, 0x39,
    0xAD, 0x76, 0x21, 0x25, 0x42, 0x49, 0xD6, 0x9A, 0xC6, 0x39, 0xC6, 0x39, 0xC6, 0x39, 0xBE, 0x18, 0xBD, 0xF8, 0x94, 0xB3, 0x29, 0x86, 0x10, 0xA2, 0x10, 0xA2,
    0x10, 0xa2, 0x10, 0xa2, 0x8C, 0x51, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x8C, 0x51, 0x10, 0xa2, 0x10, 0xa3, 0xD6, 0xBA, 0xBD, 0xF8,
    0xBD, 0xF8, 0xBD, 0xF8, 0xBD, 0xF8, 0xBD, 0xF8, 0xBD, 0xF8, 0xBD, 0xF8, 0xA5, 0x14, 0x21, 0x24, 0x42, 0x29, 0xCE, 0x59, 0xBD, 0xF8, 0xBD, 0xF8, 0xBD, 0xD7,
    0xAD, 0x75, 0x73, 0xCF, 0x29, 0x65, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x8C, 0x51, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0x8C, 0x51, 0x10, 0xa3, 0x7B, 0xCF, 0x5A, 0xCB, 0x5A, 0xCB, 0x5A, 0xCB, 0x5a, 0xcb, 0x63, 0x2C, 0xB5, 0xB7, 0xBD, 0xF8, 0xA5, 0x14,
    0x21, 0x24, 0x31, 0xA6, 0x6B, 0x6E, 0x5A, 0xEB, 0x5a, 0xcb, 0x4A, 0x6A, 0x29, 0x86, 0x18, 0xC3, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x8C, 0x51,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x8C, 0x51, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2,
    0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0xBD, 0xD7, 0xBD, 0xF8, 0xA5, 0x14, 0x21, 0x24, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2,
    0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x8C, 0x51, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x8C, 0x51, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0xBD, 0xF7, 0xBD, 0xF8, 0x9C, 0xF4, 0x21, 0x04,
    0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x8C, 0x51, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x8C, 0x51, 0x10, 0xa2, 0x10, 0xa2,
    0x10, 0xa2, 0x10, 0xa2, 0x7B, 0xCF, 0x63, 0x2D, 0x52, 0xAA, 0x18, 0xE3, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2,
    0x10, 0xa2, 0x8C, 0x51, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x8C, 0x51, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2,
    0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x8C, 0x51, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x8C, 0x51, 0x10, 0xa2,
    0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x8C, 0x51, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x8C, 0x51, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2,
    0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x8C, 0x51, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x8C, 0x51,
    0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x8C, 0x51, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x8C, 0x51, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2,
    0x8C, 0x51, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0x8C, 0x51, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x8C, 0x51, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x8C, 0x51, 0x10, 0xa2, 0x10, 0xa2, 0x8C, 0x51, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0x8C, 0x51, 0x8C, 0x51, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF} ;
;

int fmediatests ;

#define SERIALPORT   "/dev/ttyAMA0"
static int comspeed;

int errCallback(int ErrCode, unsigned char Errbyte)
{
	printf("Serial 4D Library reports error %s", Error4DText[ErrCode]);
	if (ErrCode == Err4D_NAK)
		printf(" returned data = 0x%02X\n", Errbyte) ;
	else
		printf("\n") ;

    //Abort on error?
    if (Error_Abort4D)
        exit(ErrCode);

	return ErrCode;
}

int trymount(void)
{
#define retries 20
	int i ;
	int j ;
	i = media_Init() ;
	j = 0 ;
	if (!i)
	{
		printf("Please insert the uSD card") ;
		while (   (!i)
		       && (j < retries) )
		{
			printf(".") ;
			i = media_Init() ;
			j++ ;
		}
	}
	if (j == retries)
		return FALSE ;
	else
		return TRUE ;
}

void gfx_Part1(void)
{
	int i ;
	gfx_Cls() ;
	txt_BGcolour(LIGHTGOLD) ;           // to ensure text goesn look odd
	txt_FGcolour(RED) ;
	putstr("gfx_A - gfx_L") ;
	printf("gfx_A to gfx_L\n") ;
	txt_FGcolour(LIME) ;            // reset
	gfx_ChangeColour(RED, LIME) ;
	gfx_Circle(30,20,10,BLUE) ;
	gfx_CircleFilled(60,20,10,BLUE) ;
	gfx_Rectangle(40,50,80,60,RED) ;  // draw a rectange to show where we are clipping
	gfx_ClipWindow(40,50,80,60) ;
	gfx_Clipping(ON) ;                  // turn clipping on but just use it for text
	gfx_MoveTo(20,51) ;
	putstr("1234567890asdfghjkl") ;     // this is clipped
	gfx_Clipping(OFF) ;
	usleep(1000) ;
	printf("Display off\n") ;
	gfx_Contrast(0) ;
	usleep(1000) ;
	printf("Display on + Brightness\n") ;
	for (i = 1; i <= 16; i++)
	{
		gfx_Contrast(i) ;
		usleep(100) ;
	}
//	gfx_FrameDelay(6) ;
	printf("X Res= %d  Y Res= %d\n",peekB(GFX_XMAX)+1, peekB(GFX_YMAX)+1) ;
	printf("Pixel at 60,20 is %4.4x\n", gfx_GetPixel(60, 20)) ;
	gfx_Line(0,0,100,200,BLUE) ;
	gfx_LinePattern(0x00aa) ;
	gfx_Set(OBJECT_COLOUR, WHITE);
	gfx_LineTo(90,40) ;
	gfx_LinePattern(0) ;            // reset
	gfx_BGcolour(BLACK) ;           // reset
	txt_BGcolour(BLACK) ;           // reset
	gfx_Contrast(8) ;
}

void gfx_Part2(void)
{
	int i ;
	int k ;
	int l ;
	WORD orbitx ;
	WORD orbity ;
	WORD vx[20] ;    // : array[0..19] of word ;
	WORD vy[20] ; //     : array[0..19] of word ;
	gfx_Cls() ;
	putstr("gfx_M - gfx_O") ;
	printf("gfx_M to gfx_T\n") ;
	k = 46 ;
	l = 32 ;
	gfx_MoveTo(k, l);
	gfx_CircleFilled(k,l,5,BLUE) ;
	i = -90;   // 12 o'clock position
	while (i<270)
	{
		gfx_Orbit(i, 25, &orbitx, &orbity);
		k = 3;
		if ((i % 90) == 0 )
			k = 5;
		gfx_Circle(orbitx , orbity, k, BLUE);
		i += 30;   // each 30 degreees
	}

	gfx_OutlineColour(YELLOW) ;
	gfx_RectangleFilled(80,10,95,60,LIME) ;
	gfx_OutlineColour(0) ;                    // turn outline off

	usleep(1000) ;
	gfx_Cls() ;
	putstr("gfx_P - gfx_P") ;
	printf("gfx_P to gfx_P\n") ;
	vx[0] = 18;   vy[0] = 55;
	vx[1] = 18;   vy[1] = 40;
	vx[2] = 25;   vy[2] = 40;
	vx[3] = 25;   vy[3] = 55;
	vx[4] = 46;   vy[4] = 63;
	vx[5] = 55;   vy[5] = 39;
	vx[6] = 64;   vy[6] = 63;
	vx[7] = 46;   vy[7] = 29;
	vx[8] = 55;   vy[8] = 35;
	vx[9] = 64;   vy[9] = 29;
	vx[10] = 80; vy[10] = 25;
	vx[11] = 80; vy[11] = 39;
	vx[12] = 70; vy[12] = 49;
	vx[13] = 90; vy[13] = 49;
	vx[14] = 80; vy[14] = 39;
	vx[15] = 71; vy[15] = 29;
	vx[16] = 80; vy[16] = 35;
	vx[17] = 89; vy[17] = 29;
	// house
	gfx_Rectangle(3,25,33,55,RED);             // frame
	gfx_Triangle(3,25,18,4,33,25,YELLOW);       // roof
	gfx_Polyline(4, vx, vy, CYAN);            // door
	gfx_PutPixel(20, 47, LIME) ;          // door knob
	// man
	gfx_Circle(55, 13, 10, BLUE);               // head
	gfx_Line(55, 25, 55, 39, BLUE);             // body
	gfx_Polyline(3, &vx[4], &vy[4], CYAN);      // legs
	gfx_Polyline(3, &vx[7], &vy[7], BLUE);      // arms
	// woman
	gfx_Circle(80, 13, 10, PINK);              // head
	gfx_Polyline(5, &vx[10], &vy[10], BROWN);   // dress
	gfx_Line(74, 63, 76, 49, PINK);          // left arm
	gfx_Line(82, 49, 86, 63, PINK);          // right arm
	gfx_Polyline(3, &vx[15], &vy[15], SALMON);  // dress

	usleep(1000) ;
	gfx_Cls() ;
	putstr("gfx_P - gfx_T") ;
	printf("gfx_P to gfx_T\n") ;
	vx[0] = 45; vy[0] = 20;
	vx[1] = 55; vy[1] = 10;
	vx[2] = 95; vy[2] = 20;
	vx[3] = 60; vy[3] = 25;
	vx[4] = 95; vy[4] = 30;
	vx[5] = 55; vy[5] = 40;
	vx[6] = 45; vy[6] = 30;
	gfx_Polygon(7, vx, vy, RED);

	gfx_Rectangle(0,10, 10,60, AQUA) ;
	gfx_RectangleFilled(20,10, 40,60, ORANGE) ;
//	gfx_ScreenMode(LANDSCAPE) ;
//	gfx_ScreenMode(PORTRAIT) ;
	gfx_Transparency(ON) ;
	gfx_TransparentColour(YELLOW) ;  // how do we 'test' this?
	gfx_Triangle(50,60, 70,40, 90,60,YELLOW);
}

void Joystick_Tests(void)
{
	int i ;
 	int oldi ;
	gfx_Cls() ;
	printf("Joystick Tests\n") ;
	putstr("Joystick Tests\nPress Fire to\nExit") ;
	txt_FGcolour(RED) ;
	i = -1 ;
	while (i != FIRE)
	{
		oldi = i ;
		i = joystick() ;
		if (i != oldi)
		{
			txt_MoveCursor(5,3) ;
			switch (i)
		    {
				case RELEASED : putstr("Released") ;
					break ;
				case UP       : putstr("   Up   ") ;
					break ;
				case LEFT     : putstr("  Left  ") ;
					break ;
				case DOWN     : putstr("  Down  ") ;
					break ;
				case RIGHT    : putstr("  Right ") ;
					break ;
				case FIRE     : putstr("  Fire  ") ;
					break ;
			}
		}
	}

	txt_FGcolour(LIME) ;
}

void text_Tests(void)
{
	gfx_Cls() ;
	printf("Text Tests\n") ;
	putstr("Text Tests") ;

	txt_Attributes(BOLD + INVERSE + ITALIC + UNDERLINED) ;
	txt_Xgap(3) ;
	txt_Ygap(3) ;
	txt_BGcolour(YELLOW) ;
	txt_FGcolour(WHITE) ;
	txt_FontID(SYSTEM) ;
	txt_MoveCursor(2, 0) ;
	putstr("Hello There") ;

	txt_MoveCursor(4, 1) ;
	txt_Height(2) ;
	txt_Width(1) ;
	txt_Inverse(OFF) ;
	txt_Italic(OFF) ;
	txt_Opacity(TRANSPARENT) ;
	txt_Set(TEXT_COLOUR, LIME) ;
	txt_Underline(ON) ;
	txt_Bold(OFF) ;
	putstr("Hello There") ;
	txt_Height(1) ;
	txt_Width(1) ;
	putCH('z') ;
	printf("Char height= %d Width= %d\n", charheight('w'), charwidth('w') ) ;
	txt_BGcolour(BLACK) ;
	txt_FGcolour(LIME) ;
	txt_FontID(SYSTEM) ;
	txt_MoveCursor(0,0) ;      // reset
}

void Media_Tests(void)
{
	gfx_Cls() ;
	putstr("Media Tests") ;
	printf("Media Tests\n") ;
	media_SetAdd(3, 0x600) ;     // using addresses from .dat file
	media_Image(20,20) ;
	usleep(1000) ;

	media_SetAdd(0, 0x3800) ;    // ditto
	media_Video(0,0) ;

	media_SetSector(1, 0) ;     // pic a sector not used by the 'above'
	media_WriteByte(0x11) ;
	media_WriteWord(0x2233) ;
	media_Flush() ;            // should write 0xFF over the rest of the sector
	media_SetSector(1, 0) ;
	printf("\n%2.2x %4.4x %4.4x\n",media_ReadByte(), media_ReadWord(), media_ReadWord());
}


int Callback(int ErrCode, unsigned char Errbyte)
{
	printf("Serial 4D Library reports error %s", Error4DText[ErrCode]) ;
	if (ErrCode == Err4D_NAK)
		printf(" returned data= %x\n", Errbyte) ;
	else
		printf("\n") ;
	exit(2) ;
	return 0 ; // to make compiler happy
}


int main() 
{
    int i, rc;
    char wks[20] ;
    
    TimeLimit4D = 9000000;
    Callback4D = errCallback;
    // abort on detected 4D Serial error
    Error_Abort4D = 1 ;
    comspeed = 9600;
    //WORD *x = 0x001A;
    //char *s = sys_GetModel(&x);
    //x  = &0x001A;
    rc = OpenComm(SERIALPORT, comspeed);
    if (rc != 0)
    {
        printf("Error %d Opening: %s - %s\n", errno, SERIALPORT, strerror(errno));
        exit(EXIT_FAILURE);
    }
    usleep(10000);
	gfx_Cls() ;
	fmediatests = trymount() ;
	sys_GetModel(wks) ; // length is also returned, but we don't need that here
	printf("Display model: %s\n", wks) ;
	putstr("Model:\n") ;
        putstr(wks) ;
	i = strlen(wks) ;
	printf("SPE2 Version: %4.4x\n", sys_GetVersion()) ;
	printf("PmmC Version: %4.4x\n", sys_GetPmmC()) ;
	if (fmediatests)
  		printf("Media tests will be done\n") ;
  	else
 	    printf("Media tests cannot be done, missing uSD card\n") ;

	usleep(500000) ;

	gfx_Part1() ; // GFX Part 1 tests
	usleep(500000) ;

	gfx_Part2() ; // GFX Part 2 tests
	usleep(500000) ;

	text_Tests() ; // text tests
	usleep(500000) ;

	Joystick_Tests() ;
	usleep(500000) ;

	gfx_Cls() ;
	blitComtoDisplay(50, 50, Image[1], Image[3], &Image[6]) ;
 	usleep(500000) ;

	if (fmediatests)
	{
		Media_Tests() ;
		usleep(500000) ;
	}


        int nt;
        for(nt = 0; nt <=64; nt++)
        {
            BeeP(nt,100) ;
            usleep(100);
        }
    	  SSTimeout(0) ;
          
    return (0); 
}

